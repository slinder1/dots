#!/bin/bash

usage() {
  >&2 printf 'rocm-sources - update /etc/apt/sources.list.d/rocm.list to either\n'
  >&2 printf '               the latest ROCm release or a specific OSDB build\n\n'
  >&2 printf 'usage: %s [-h] [build-id build-number]\n' "$0"
}

OPTIND=1

while getopts ':' opt; do
  case "$opt" in
    h|\?)
      usage
      exit 0
      ;;
  esac
done

shift $((OPTIND-1))

if [ $# -ne 0 ] && [ $# -ne 2 ]; then
    usage
    exit 1
fi

if [ $# -eq 0 ]; then
  SOURCE="deb [arch=amd64] http://repo.radeon.com/rocm/apt/debian/ xenial main"
else
  SOURCE=$(printf \
    "deb [arch=amd64 trusted=yes] http://compute-artifactory.amd.com/artifactory/list/rocm-osdb-deb/ %s %s" "$1" "$2")
fi

printf "%s\n" "$SOURCE" | sudo tee /etc/apt/sources.list.d/rocm.list
