#!/usr/bin/perl
use strict;
use warnings;

# Make room in LLVM IR for new MDNode IDs by incrementing references to MDNode
# IDs in stdin, writing the result to stdout. The amount to offset all MDNode
# IDs by is the only argument.
#
# Note: Just uses a regex which matches on an exclamation point followed by a
# sequence of digits. This may be incorrect in some cases, so always make sure
# the result looks how you intend.

my $id_offset = $ARGV[0] || die 'usage: mdnode-insert-ids id_offset';

while (<STDIN>) {
    s/!(\d+)/{"!" . ($1 + $id_offset)}/eg;
    print;
}
